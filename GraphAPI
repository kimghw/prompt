# 📘 Microsoft Graph API 이메일 조회 완벽 가이드

이 문서는 Microsoft Graph API를 활용하여 특정 사용자 또는 모든 사용자의 메일을 효과적으로 조회하는 방법을 체계적으로 안내합니다. OData 쿼리 매개변수를 활용한 기본 및 고급 필터링 예제를 포함하고 있습니다.

### 1. 기본 API 엔드포인트

- **내 메일 조회 (위임된 권한):**
  ```http
  GET [https://graph.microsoft.com/v1.0/me/messages](https://graph.microsoft.com/v1.0/me/messages)
  ```
- **특정 사용자 메일 조회 (위임된/애플리케이션 권한):**
  ```http
  GET [https://graph.microsoft.com/v1.0/users/](https://graph.microsoft.com/v1.0/users/){사용자 ID 또는 UPN}/messages
  ```

---

### 2. 핵심 OData 쿼리 매개변수

| 매개변수      | 설명                                                               | 사용 예시                                   |
| :---------- | :----------------------------------------------------------------- | :------------------------------------------ |
| **`$select`** | 응답에 포함할 특정 필드만 선택하여 데이터 크기를 최적화합니다.     | `$select=subject,from,receivedDateTime`     |
| **`$filter`** | 특정 조건에 맞는 데이터만 필터링합니다.                            | `$filter=isRead eq false` (읽지 않은 메일만) |
| **`$orderby`** | 결과를 특정 필드를 기준으로 정렬합니다. (`asc`/`desc`)             | `$orderby=receivedDateTime desc` (최신순)    |
| **`$top`** | 결과의 개수를 상위 N개로 제한합니다.                               | `$top=10` (최대 10개)                      |
| **`$search`** | 키워드로 메시지를 검색합니다. (인덱싱된 모든 필드에서 검색)        | `$search="회의록"`                          |

---

### 3. 주요 조회 시나리오별 API 요청 예시

*아래 모든 예시는 `https://graph.microsoft.com/v1.0` 뒤에 붙여서 사용하시면 됩니다.*

#### 📈 **A. 기간 및 개수 필터링**

**1. 최근 메일 10개 조회**
> `orderby`로 최신순 정렬 후 `top`으로 개수를 제한합니다.
```http
GET /me/messages?$orderby=receivedDateTime desc&$top=10
```

**2. 특정 기간의 메일 조회 (예: 2025년 5월)**
> `filter`를 사용하여 `receivedDateTime`이 특정 범위에 있는지 확인합니다.
```http
GET /me/messages?$filter=receivedDateTime ge 2025-05-01T00:00:00Z and receivedDateTime lt 2025-06-01T00:00:00Z
```

#### 📂 **B. 상태 및 속성 필터링**

**1. 읽지 않은 메일만 조회**
> `isRead` 속성을 `false`로 필터링합니다.
```http
GET /me/messages?$filter=isRead eq false
```

**2. 특정인에게서 온 메일 조회**
> `from` 주소의 `emailAddress` 객체를 필터링합니다.
```http
GET /me/messages?$filter=from/emailAddress/address eq 'noreply@google.com'
```

**3. '중요' 표시가 있는 메일만 조회**
> `importance` 속성을 필터링합니다. (`low`, `normal`, `high`)
```http
GET /me/messages?$filter=importance eq 'high'
```

#### 🔍 **C. 내용 검색 및 필드 선택**

**1. 제목, 본문 등에서 키워드 검색**
> `search`를 사용하여 자유로운 텍스트 검색을 수행합니다. (가장 편리함)
```http
GET /me/messages?$search="프로젝트 제안서"
```

**2. 특정 필드만 선택하여 조회 (성능 최적화)**
> `select`를 사용하여 제목, 보낸 사람, 받은 날짜만 가져옵니다.
```http
GET /me/messages?$select=subject,from,receivedDateTime
```

**3. 본문을 일반 텍스트(TEXT) 형식으로 받기**
> `Prefer` 헤더를 추가하여 HTML이 아닌 TEXT 형식의 본문을 요청합니다.
```http
GET /me/messages?$select=subject,body
Prefer: outlook.body-content-type="text"
```

---

### 4. 고급 조합 예시

> **"2025년 5월 한 달간 '김민준'에게서 온 읽지 않은 메일을 최신순으로 5개 조회하되, 제목과 받은 날짜만 가져오기"**

```http
GET /me/messages?$filter=receivedDateTime ge 2025-05-01T00:00:00Z and receivedDateTime lt 2025-06-01T00:00:00Z and from/emailAddress/address eq 'minjun.kim@example.com' and isRead eq false&$orderby=receivedDateTime desc&$top=5&$select=subject,receivedDateTime
```

---
*이 가이드가 Graph API를 활용한 메일 기능 개발에 도움이 되기를 바랍니다.*
